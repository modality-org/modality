---
description: Rules for writing tests in the tests/network directory
---

# Tests Directory Guidelines

- use direnv within this directory of tests
- `rebuild` runs `cargo build --package modal` in the rust directory

## Purpose
- Write each test to teach users how to use the modal CLI
- Each test should also be runnable as an integration test
- Use test.sh in each test directory to run the test

## File Structure
- Write a README.md file in each test directory that explains the test and how to run it
- Use numbered directories (01-*, 02-*, etc.) for stable tests
- Use unnumbered directories for work-in-progress tests
- tmp/ is a temporary directory for tests to use (gitignored)

## Using the Modal CLI

**IMPORTANT: Always use `modal` command directly, never with explicit paths**

✅ **CORRECT:**
```bash
modal node run --config ./configs/node1.json
modal contract create --dir ./tmp/my-contract
modal program create --dir ./tmp/my-program
```

❌ **INCORRECT:**
```bash
../../../rust/target/debug/modal node run ...
../../rust/target/release/modal contract create ...
```

### Rationale
- Assume that command `modal` is available in the PATH
- When testing, the modal binary that takes precedence in the path is the one in rust/target/debug directory
- This makes tests cleaner and more like real-world usage
- The debug binary is used for tests, not the release binary

## Network Configuration
- Use devnet1 as the default network for all tests unless otherwise specified
- When creating a node, use `modal node create` command to create the node in the tmp/ directory

## Node Inspection
- Prefer `modal node inspect` over stopping a node and querying the datastore directly
- When a `modal node inspect` method isn't available to fetch the data needed, implement it

## Testing
- Each test should be modular and self-contained
- Tests should be valuable when run sequentially to test the entire test suite
- Use ./test-numbered-tests.sh to test all numbered tests
- Test all numbered tests for regressions after creating a new unnumbered test

## Creating New Tests
- Create a new unnumbered test directory first
- Create a test.sh file for the test
- Only promote to a numbered test if specifically asked to do so
- Follow the pattern of existing tests (01-ping-node/, 04-sync-miner-blocks/, etc.)

## Code Modifications
- Don't alter code in the numbered tests, only in the unnumbered tests, unless otherwise specified
- This preserves stable tests that are known to work
