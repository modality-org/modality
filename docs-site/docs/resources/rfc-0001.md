---
sidebar_position: 1
title: RFC-0001 Specification
---

# RFC-0001: Modal Contract Specification

:::info
Full RFC available at [GitHub](https://github.com/modality-org/modality/blob/main/docs/RFC-0001-MODAL-CONTRACTS.md)
:::

## Abstract

This document specifies the Modal Contract format — a verifiable contract system for multi-party cooperation using append-only logs, temporal modal logic, and cryptographic predicates.

## Overview

A Modal Contract consists of:

1. **Append-only commit log** — Immutable history of signed operations
2. **State tree** — Key-value data derived from commits
3. **Model** — Labeled transition system (state machine)
4. **Rules** — Temporal modal formulas constraining behavior
5. **Predicates** — Cryptographic conditions for transitions

## Contract Structure

```
.contract/
├── config.json        # Contract metadata
├── commits/           # Commit storage
│   ├── <hash1>
│   ├── <hash2>
│   └── ...
└── HEAD               # Current commit reference

state/                 # Working state (checkout)
model/                 # Model definitions
rules/                 # Rule definitions
```

## Commit Format

```json
{
  "parent": "<parent_commit_hash>",
  "timestamp": 1704067200,
  "author": "ed25519:<pubkey>",
  "signature": "<signature>",
  "actions": [
    {"method": "POST", "path": "/data/file.txt", "content": "..."},
    {"method": "RULE", "path": "/rules/auth.modality"},
    {"method": "MODEL", "path": "/model/default.modality"},
    {"method": "ACTION", "type": "DEPOSIT"}
  ]
}
```

## Model Syntax

```modality
model <name> {
  states { <state>, ... }
  initial <state>
  terminal <state>, ...
  
  transition <ACTION>: <from> -> <to>
    +<predicate>
}
```

## Rule Syntax

```modality
export default rule {
  starting_at $PARENT
  formula {
    <modal_formula>
  }
}
```

## Standard Predicates

| Predicate | Description |
|-----------|-------------|
| `signed_by(path)` | ed25519 signature verification |
| `threshold(path, n, m)` | n-of-m multisig |
| `oracle_attests(oracle, claim, value)` | External attestation |
| `before(path)` / `after(path)` | Timestamp constraints |
| `num_*` / `text_*` | Value comparisons |
| `hash_matches(hash, preimage)` | SHA256 commitment |

## Hub Protocol

### Authentication

Two-tier ed25519 authentication:
- **Identity key** — Long-term identity
- **Access key** — Session-based, rotatable

### Endpoints

| Method | Path | Description |
|--------|------|-------------|
| POST | `/register` | Register identity |
| POST | `/contracts` | Create contract |
| GET | `/contracts/:id` | Get contract info |
| POST | `/contracts/:id/commits` | Push commit |
| GET | `/contracts/:id/commits` | Pull commits |
| POST | `/contracts/:id/grant` | Grant access |
