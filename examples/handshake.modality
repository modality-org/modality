// Two agents shake hands with enforced rules
//
// Every commit is a transition in the governing model.
// add_rule transitions as +ADD_RULE, do +X as domain actions.

contract handshake {

  commit {
    signed_by A
    model {
      part flow {
        init --> a_ruled: +ADD_RULE +signed_by(A)
        a_ruled --> b_ruled: +ADD_RULE +signed_by(B)
        b_ruled --> a_ready: +READY +signed_by(A)
        a_ready --> done: +READY +signed_by(B)
      }
    }
    add_rule { eventually(done) }
  }

  commit {
    signed_by B
    add_rule { eventually(done) }
  }

  commit {
    signed_by A
    do +READY
  }

  commit {
    signed_by B
    do +READY
  }

}
